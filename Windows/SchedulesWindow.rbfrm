#tag WindowBegin Window SchedulesWindow   BackColor       =   16777215   Backdrop        =   ""   CloseButton     =   True   Composite       =   True   Frame           =   8   FullScreen      =   False   HasBackColor    =   False   Height          =   342   ImplicitInstance=   True   LiveResize      =   True   MacProcID       =   0   MaxHeight       =   32000   MaximizeButton  =   False   MaxWidth        =   32000   MenuBar         =   ""   MenuBarVisible  =   True   MinHeight       =   64   MinimizeButton  =   True   MinWidth        =   64   Placement       =   0   Resizeable      =   False   Title           =   "Schedules"   Visible         =   True   Width           =   532   Begin BetterPushButton DetachButton      AutoDeactivate  =   True      Bold            =   ""      ButtonStyle     =   0      Cancel          =   ""      Caption         =   "Detach"      Default         =   True      Enabled         =   False      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   432      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   ""      LockTop         =   ""      Scope           =   0      TabIndex        =   4      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "SmallSystem"      TextSize        =   0      TextUnit        =   0      Top             =   254      Underline       =   ""      Visible         =   True      Width           =   80   End   Begin Listbox SchedListbox      AutoDeactivate  =   True      AutoHideScrollbars=   True      Bold            =   ""      Border          =   True      ColumnCount     =   1      ColumnsResizable=   True      ColumnWidths    =   ""      DataField       =   ""      DataSource      =   ""      DefaultRowHeight=   20      Enabled         =   True      EnableDrag      =   ""      EnableDragReorder=   ""      GridLinesHorizontal=   0      GridLinesVertical=   0      HasHeading      =   False      HeadingIndex    =   -1      Height          =   205      HelpTag         =   ""      Hierarchical    =   ""      Index           =   -2147483648      InitialParent   =   ""      InitialValue    =   ""      Italic          =   ""      Left            =   16      LockBottom      =   False      LockedInPosition=   False      LockLeft        =   False      LockRight       =   False      LockTop         =   False      RequiresSelection=   ""      Scope           =   0      ScrollbarHorizontal=   ""      ScrollBarVertical=   True      SelectionType   =   0      TabIndex        =   1      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "SmallSystem"      TextSize        =   0      TextUnit        =   0      Top             =   37      Underline       =   ""      UseFocusRing    =   False      Visible         =   True      Width           =   496      _ScrollOffset   =   0      _ScrollWidth    =   -1   End   Begin TitleField SchedTitle      AcceptFocus     =   ""      AcceptTabs      =   ""      AutoDeactivate  =   True      Backdrop        =   ""      BackgroundColor =   13421772      BorderColor     =   12829635      DoubleBuffer    =   False      Enabled         =   True      EraseBackground =   True      Height          =   24      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Left            =   16      LockBottom      =   False      LockedInPosition=   False      LockLeft        =   False      LockRight       =   False      LockTop         =   False      Scope           =   0      TabIndex        =   0      TabPanelIndex   =   0      TabStop         =   True      Title           =   "Schedules for database"      Top             =   14      UseFocusRing    =   False      Visible         =   True      Width           =   496   End   Begin BetterPopupMenu SchedPopup      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      InitialValue    =   ""      Italic          =   ""      Left            =   16      ListIndex       =   0      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   ""      LockTop         =   ""      Scope           =   0      TabIndex        =   2      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "SmallSystem"      TextSize        =   0      TextUnit        =   0      Top             =   254      Underline       =   ""      Visible         =   True      Width           =   183   End   Begin BetterPushButton AttachButton      AutoDeactivate  =   True      Bold            =   ""      ButtonStyle     =   0      Cancel          =   ""      Caption         =   "Attach"      Default         =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   211      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   ""      LockTop         =   ""      Scope           =   0      TabIndex        =   3      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "SmallSystem"      TextSize        =   0      TextUnit        =   0      Top             =   254      Underline       =   ""      Visible         =   True      Width           =   80   End   Begin Separator Separator2      AutoDeactivate  =   True      Enabled         =   True      Height          =   4      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Left            =   16      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   ""      LockTop         =   ""      Scope           =   0      TabIndex        =   5      TabPanelIndex   =   0      TabStop         =   True      Top             =   286      Visible         =   True      Width           =   496   End   Begin BetterPushButton SchedCloseButton      AutoDeactivate  =   True      Bold            =   ""      ButtonStyle     =   0      Cancel          =   ""      Caption         =   "Close"      Default         =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   432      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   ""      LockTop         =   ""      Scope           =   0      TabIndex        =   6      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "SmallSystem"      TextSize        =   0      TextUnit        =   0      Top             =   302      Underline       =   ""      Visible         =   True      Width           =   80   EndEnd#tag EndWindow#tag WindowCode	#tag Method, Flags = &h0		Sub Constructor(db As CubeSQLServer, dbname As String, parentWindow as Window)		  Super.Window()		  mdb = db		  mdbname = dbname		  SchedTitle.Title = "Schedules for database " + mdbname		  		  // update SchedPopup		  Dim rs As RecordSet = mdb.SQLSelect("SHOW SCHEDULES")		  if (rs<>nil) then		    while not rs.EOF		      SchedPopup.AddRow rs.IdxField(1).getString		      rs.MoveNext		    wend		    SchedPopup.ListIndex = 0		  end if		  		  // update ListBox		  UpdateSchedListBox		  		  me.ShowModalWithin(parentWindow)		End Sub	#tag EndMethod	#tag Method, Flags = &h21		Private Function DoExecute(sql As String) As Boolean		  mdb.SQLExecute(sql)		  if (mdb.Error) then		    MsgBox mdb.ErrorMessage + EndOfLine + EndOfLine + "Error code:" + Str(mdb.ErrorCode)		    return false		  end if		  		  return true		End Function	#tag EndMethod	#tag Method, Flags = &h21		Private Sub UpdateSchedListBox()		  SchedListbox.DeleteAllRows		  Dim rs As RecordSet = mdb.SQLSelect("SHOW SCHEDULES FOR DATABASE '" + mdbname + "'")		  if (rs=nil) or (rs.RecordCount = 0) then  return		  		  while not rs.EOF		    SchedListbox.AddRow rs.IdxField(1).getString		    rs.MoveNext		  wend		  rs = nil		End Sub	#tag EndMethod	#tag Property, Flags = &h21		Private mdb As CubeSQLServer	#tag EndProperty	#tag Property, Flags = &h21		Private mdbname As String	#tag EndProperty#tag EndWindowCode#tag Events DetachButton	#tag Event		Sub Action()		  Dim sql As String = "DETACH SCHEDULE '" +SchedListbox.Cell(SchedListbox.ListIndex, 0) + "' FROM DATABASE '" + mdbname +"'"		  if (DoExecute(sql)) then UpdateSchedListBox		End Sub	#tag EndEvent#tag EndEvents#tag Events SchedListbox	#tag Event		Function CellBackgroundPaint(g As Graphics, row As Integer, column As Integer) As Boolean		  if row mod 2 = 0 then		    g.ForeColor = RGB(237, 243, 254)//&cEEEEEE //RGB(237, 243, 254)		    g.FillRect 0, 0, g.Width, g.Height		  end if		End Function	#tag EndEvent	#tag Event		Sub Change()		  DetachButton.Enabled = (me.ListIndex <> -1)		End Sub	#tag EndEvent#tag EndEvents#tag Events AttachButton	#tag Event		Sub Action()		  Dim sql As String = "ATTACH SCHEDULE '" +SchedPopup.Text + "' TO DATABASE '" + mdbname +"'"		  if (DoExecute(sql)) then UpdateSchedListBox		End Sub	#tag EndEvent#tag EndEvents#tag Events SchedCloseButton	#tag Event		Sub Action()		  me.Window.Close		End Sub	#tag EndEvent#tag EndEvents