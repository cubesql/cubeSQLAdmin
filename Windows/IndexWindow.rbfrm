#tag WindowBegin Window IndexWindow   BackColor       =   16777215   Backdrop        =   ""   CloseButton     =   True   Composite       =   True   Frame           =   1   FullScreen      =   False   HasBackColor    =   False   Height          =   388   ImplicitInstance=   True   LiveResize      =   True   MacProcID       =   0   MaxHeight       =   32000   MaximizeButton  =   False   MaxWidth        =   32000   MenuBar         =   ""   MenuBarVisible  =   True   MinHeight       =   368   MinimizeButton  =   True   MinWidth        =   448   Placement       =   2   Resizeable      =   True   Title           =   "Index Editor"   Visible         =   True   Width           =   448   Begin Label TitleField      AutoDeactivate  =   True      Bold            =   True      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   15      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   20      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   False      LockTop         =   True      Multiline       =   ""      Scope           =   0      Selectable      =   False      TabIndex        =   1      TabPanelIndex   =   0      TabStop         =   True      Text            =   "Index name:"      TextAlign       =   0      TextColor       =   0      TextFont        =   "SmallSystem"      TextSize        =   0      TextUnit        =   0      Top             =   18      Transparent     =   True      Underline       =   ""      Visible         =   True      Width           =   90   End   Begin TextField NameField      AcceptTabs      =   ""      Alignment       =   0      AutoDeactivate  =   True      BackColor       =   16777215      Bold            =   ""      Border          =   True      CueText         =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Format          =   ""      Height          =   22      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   115      LimitText       =   0      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   True      LockTop         =   True      Mask            =   ""      Password        =   ""      ReadOnly        =   ""      Scope           =   0      TabIndex        =   0      TabPanelIndex   =   0      TabStop         =   True      Text            =   ""      TextColor       =   0      TextFont        =   "SmallSystem"      TextSize        =   0      TextUnit        =   0      Top             =   14      Underline       =   ""      UseFocusRing    =   False      Visible         =   True      Width           =   313   End   Begin Label StaticText1      AutoDeactivate  =   True      Bold            =   True      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   15      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   20      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   False      LockTop         =   True      Multiline       =   ""      Scope           =   0      Selectable      =   False      TabIndex        =   2      TabPanelIndex   =   0      TabStop         =   True      Text            =   "Table:"      TextAlign       =   0      TextColor       =   0      TextFont        =   "SMallSystem"      TextSize        =   0      TextUnit        =   0      Top             =   48      Transparent     =   True      Underline       =   ""      Visible         =   True      Width           =   80   End   Begin BetterPopupMenu TablePopup      AutoDeactivate  =   True      Bold            =   True      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      InitialValue    =   ""      Italic          =   ""      Left            =   115      ListIndex       =   0      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Scope           =   0      TabIndex        =   3      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "SmallSystem"      TextSize        =   0      TextUnit        =   0      Top             =   45      Underline       =   ""      Visible         =   True      Width           =   231   End   Begin ListBox FieldsListBox      AutoDeactivate  =   True      AutoHideScrollbars=   False      Bold            =   ""      Border          =   True      ColumnCount     =   2      ColumnsResizable=   True      ColumnWidths    =   40,      DataField       =   ""      DataSource      =   ""      DefaultRowHeight=   16      Enabled         =   True      EnableDrag      =   ""      EnableDragReorder=   ""      GridLinesHorizontal=   0      GridLinesVertical=   0      HasHeading      =   True      HeadingIndex    =   -1      Height          =   228      HelpTag         =   ""      Hierarchical    =   ""      Index           =   -2147483648      InitialParent   =   ""      InitialValue    =   " 	Column"      Italic          =   ""      Left            =   20      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   True      LockTop         =   True      RequiresSelection=   ""      Scope           =   0      ScrollbarHorizontal=   ""      ScrollBarVertical=   True      SelectionType   =   0      TabIndex        =   5      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "SmallSystem"      TextSize        =   0      TextUnit        =   0      Top             =   93      Underline       =   ""      UseFocusRing    =   False      Visible         =   True      Width           =   407      _ScrollOffset   =   0      _ScrollWidth    =   -1   End   Begin Separator Separator1      AutoDeactivate  =   True      Enabled         =   True      Height          =   4      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Left            =   20      LockBottom      =   False      LockedInPosition=   False      LockLeft        =   True      LockRight       =   True      LockTop         =   True      Scope           =   0      TabIndex        =   4      TabPanelIndex   =   0      TabStop         =   True      Top             =   77      Visible         =   True      Width           =   407   End   Begin Separator Separator2      AutoDeactivate  =   True      Enabled         =   True      Height          =   4      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Left            =   20      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   True      LockTop         =   ""      Scope           =   0      TabIndex        =   6      TabPanelIndex   =   0      TabStop         =   True      Top             =   333      Visible         =   True      Width           =   408   End   Begin BetterPushButton SaveButton      AutoDeactivate  =   True      Bold            =   False      ButtonStyle     =   0      Cancel          =   ""      Caption         =   "Save"      Default         =   True      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   348      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   True      LockTop         =   ""      Scope           =   0      TabIndex        =   8      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "SmallSystem"      TextSize        =   0      TextUnit        =   0      Top             =   349      Underline       =   ""      Visible         =   True      Width           =   80   End   Begin BetterPushButton CancelButton      AutoDeactivate  =   True      Bold            =   False      ButtonStyle     =   0      Cancel          =   True      Caption         =   "Cancel"      Default         =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   256      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   True      LockTop         =   ""      Scope           =   0      TabIndex        =   7      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "SmallSystem"      TextSize        =   0      TextUnit        =   0      Top             =   349      Underline       =   ""      Visible         =   True      Width           =   80   EndEnd#tag EndWindow#tag WindowCode	#tag Method, Flags = &h0		Sub Constructor(parentDB as Database)		  Super.Window()		  db = parentDB		  		  // trigger methods		  me.SetPanel		  me.ShowModal		End Sub	#tag EndMethod	#tag Method, Flags = &h21		Private Function SanityCheck() As Boolean		  dim i,count as Integer		  dim idxname as String = NameField.Text		  dim checked as Boolean = false		  		  // Check table name		  if (TablePopup.Text.Len = 0) then		    MsgBox "Index cannot be created because the table field cannot be empty."		    return false		  end if		  		  // Empty name		  if (idxname.Len = 0) then		    MsgBox "Index cannot be created because index name cannot be empty."		    return false		  end if		  		  // At least one field checked		  count = FieldsListBox.ListCount-1		  for i=0 to count		    if (FieldsListBox.CellCheck(i, 0) = true) then		      checked = true		    end if		  next		  		  if (checked = false) then		    MsgBox "Index cannot be created because at least one column must be selected."		    return false		  end if		  		  return true		End Function	#tag EndMethod	#tag Method, Flags = &h21		Private Function SaveIndex() As Boolean		  dim sql, fields As String		  dim i, count As Integer		  		  sql = "CREATE INDEX"		  sql = sql + " " + NameField.Text + " ON " + TablePopup.Text + "("		  		  count = FieldsListBox.ListCount-1		  for i=0 to count		    if (FieldsListBox.CellCheck(i, 0) = true) then		      fields = fields + FieldsListBox.Cell(i,1) + ","		    end if		  next		  		  sql = sql + fields.left(fields.len-1) + ")"		  		  db.SQLExecute(sql)		  if (db.Error = true) then		    MsgBox db.ErrorMessage		    return false		  end if		  		  db.Commit		  return true		End Function	#tag EndMethod	#tag Method, Flags = &h21		Private Sub SetPanel()		  Dim rs As RecordSet = db.SQLSelect("SHOW TABLES")		  if (rs=nil) or (rs.RecordCount = 0) then return		  		  while not rs.EOF		    TablePopup.AddRow rs.IdxField(1).getString		    rs.MoveNext		  wend		  rs = nil		  TablePopup.ListIndex = 0		End Sub	#tag EndMethod	#tag Property, Flags = &h0		button As String	#tag EndProperty	#tag Property, Flags = &h21		Private db As Database	#tag EndProperty	#tag Property, Flags = &h0		itemName As String	#tag EndProperty#tag EndWindowCode#tag Events TablePopup	#tag Event		Sub Change()		  FieldsListBox.DeleteAllRows		  		  Dim rs As RecordSet		  Dim tableName As String = me.Text		  		  if (tableName.len > 0) then		    rs = db.SQLSelect("pragma table_info(" + tableName+ ")")		    if rs <> nil then		      while not rs.EOF		        FieldsListBox.AddRow ""		        FieldsListBox.Cell(FieldsListBox.LastIndex, 1) = rs.Field("name").StringValue		        rs.MoveNext		      wend		    end if		  end if		End Sub	#tag EndEvent#tag EndEvents#tag Events FieldsListBox	#tag Event		Function CellBackgroundPaint(g As Graphics, row As Integer, column As Integer) As Boolean		  if row mod 2 = 0 then		    g.ForeColor = RGB(237, 243, 254)		    g.FillRect 0, 0, g.Width, g.Height		  end if		  		  		End Function	#tag EndEvent	#tag Event		Sub Open()		  #If TargetLinux		    me.TextSize = 10		  #endif		  		  me.ColumnType(0) = 2		  me.ColumnAlignmentOffset(1) = 5		End Sub	#tag EndEvent#tag EndEvents#tag Events SaveButton	#tag Event		Sub Action()		  if (SanityCheck=false) then return		  if (SaveIndex=false) then return		  me.Window.Close		End Sub	#tag EndEvent#tag EndEvents#tag Events CancelButton	#tag Event		Sub Action()		  me.Window.Close		End Sub	#tag EndEvent#tag EndEvents